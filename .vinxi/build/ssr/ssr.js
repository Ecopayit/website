import{RouterProvider as U,isPlainObject as h,warning as V,pick as K,TSR_DEFERRED_PROMISE as G,isPlainArray as J,defer as Y,createMemoryHistory as Z,createControlledPromise as Q,invariant as X,createRootRoute as ee,Outlet as te,HeadContent as re,Scripts as ne,createFileRoute as se,lazyRouteComponent as oe,createRouter as ae}from"@tanstack/react-router";import{jsx as u,jsxs as H}from"react/jsx-runtime";import{splitSetCookieString as ie}from"cookie-es";import{eventHandler as ce,toWebRequest as de,getResponseHeaders as le}from"h3";import S from"jsesc";import"node:async_hooks";import{Readable as M,PassThrough as ue}from"node:stream";import{isbot as z}from"isbot";import v from"react-dom/server";import{ReadableStream as fe}from"node:stream/web";function N(e){return u(U,{router:e.router})}function pe(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function k(...e){return e.reduce((r,t)=>{const s=pe(t);for(const[n,o]of s.entries())n==="set-cookie"?ie(o).forEach(d=>r.append("set-cookie",d)):r.set(n,o);return r},new Headers)}const y={stringify:e=>JSON.stringify(e,function(t,s){const n=this[t],o=b.find(i=>i.stringifyCondition(n));return o?o.stringify(n):s}),parse:e=>JSON.parse(e,function(t,s){const n=this[t];if(h(n)){const o=b.find(i=>i.parseCondition(n));if(o)return o.parse(n)}return s}),encode:e=>{if(Array.isArray(e))return e.map(t=>y.encode(t));if(h(e))return Object.fromEntries(Object.entries(e).map(([t,s])=>[t,y.encode(s)]));const r=b.find(t=>t.stringifyCondition(e));return r?r.stringify(e):e},decode:e=>{if(h(e)){const r=b.find(t=>t.parseCondition(e));if(r)return r.parse(e)}return Array.isArray(e)?e.map(r=>y.decode(r)):h(e)?Object.fromEntries(Object.entries(e).map(([r,t])=>[r,y.decode(t)])):e}},_=(e,r,t,s)=>({key:e,stringifyCondition:r,stringify:n=>({[`$${e}`]:t(n)}),parseCondition:n=>Object.hasOwn(n,`$${e}`),parse:n=>s(n[`$${e}`])}),b=[_("undefined",e=>e===void 0,()=>0,()=>{}),_("date",e=>e instanceof Date,e=>e.toISOString(),e=>new Date(e)),_("error",e=>e instanceof Error,e=>({...e,message:e.message,stack:void 0,cause:e.cause}),e=>Object.assign(new Error(e.message),e)),_("formData",e=>e instanceof FormData,e=>{const r={};return e.forEach((t,s)=>{const n=r[s];n!==void 0?Array.isArray(n)?n.push(t):r[s]=[n,t]:r[s]=t}),r},e=>{const r=new FormData;return Object.entries(e).forEach(([t,s])=>{Array.isArray(s)?s.forEach(n=>r.append(t,n)):r.append(t,s)}),r}),_("bigint",e=>typeof e=="bigint",e=>e.toString(),e=>BigInt(e))],me=`const __TSR_SSR__={matches:[],streamedValues:{},initMatch:o=>(__TSR_SSR__.matches.push(o),o.extracted?.forEach(l=>{if(l.type==="stream"){let r;l.value=new ReadableStream({start(e){r={enqueue:t=>{try{e.enqueue(t)}catch{}},close:()=>{try{e.close()}catch{}}}}}),l.value.controller=r}else{let r,e;l.value=new Promise((t,a)=>{e=a,r=t}),l.value.reject=e,l.value.resolve=r}}),!0),resolvePromise:({matchId:o,id:l,promiseState:r})=>{const e=__TSR_SSR__.matches.find(t=>t.id===o);if(e){const t=e.extracted?.[l];if(t&&t.type==="promise"&&t.value&&r.status==="success")return t.value.resolve(r.data),!0}return!1},injectChunk:({matchId:o,id:l,chunk:r})=>{const e=__TSR_SSR__.matches.find(t=>t.id===o);if(e){const t=e.extracted?.[l];if(t&&t.type==="stream"&&t.value?.controller)return t.value.controller.enqueue(new TextEncoder().encode(r.toString())),!0}return!1},closeStream:({matchId:o,id:l})=>{const r=__TSR_SSR__.matches.find(e=>e.id===o);if(r){const e=r.extracted?.[l];if(e&&e.type==="stream"&&e.value?.controller)return e.value.controller.close(),!0}return!1},cleanScripts:()=>{document.querySelectorAll(".tsr-once").forEach(o=>{o.remove()})}};window.__TSR_SSR__=__TSR_SSR__;
`;function he(e,r){e.ssr={manifest:r,serializer:y},e.serverSsr={injectedHtml:[],streamedKeys:new Set,injectHtml:t=>{const s=Promise.resolve().then(t);return e.serverSsr.injectedHtml.push(s),e.emit({type:"onInjectedHtml",promise:s}),s.then(()=>{})},injectScript:(t,s)=>e.serverSsr.injectHtml(async()=>`<script class='tsr-once'>${await t()}; if (typeof __TSR_SSR__ !== 'undefined') __TSR_SSR__.cleanScripts()<\/script>`),streamValue:(t,s)=>{V(!e.serverSsr.streamedKeys.has(t),"Key has already been streamed: "+t),e.serverSsr.streamedKeys.add(t),e.serverSsr.injectScript(()=>`__TSR_SSR__.streamedValues['${t}'] = { value: ${S(e.ssr.serializer.stringify(s),{isScriptContext:!0,wrap:!0,json:!0})}}`)},onMatchSettled:ye},e.serverSsr.injectScript(()=>me,{logScript:!1})}function Se(e){var r,t;const s={manifest:e.ssr.manifest,dehydratedData:(t=(r=e.options).dehydrate)==null?void 0:t.call(r)};e.serverSsr.injectScript(()=>`__TSR_SSR__.dehydrated = ${S(e.ssr.serializer.stringify(s),{isScriptContext:!0,wrap:!0,json:!0})}`)}function _e(e,r){const t=[];return{replaced:A(e,(n,o)=>{if(n instanceof ReadableStream){const[i,d]=n.tee(),a={type:"stream",path:o,id:t.length,matchIndex:r.match.index,stream:d};return t.push(a),i}else if(n instanceof Promise){const i=Y(n),d={type:"promise",path:o,id:t.length,matchIndex:r.match.index,promise:i};t.push(d)}return n}),extracted:t}}function ye(e){const{router:r,match:t}=e;let s,n;if(t.loaderData!==void 0){const a=_e(t.loaderData,{match:t});t.loaderData=a.replaced,s=a.extracted,n=s.reduce((p,f)=>P(p,["temp",...f.path],void 0),{temp:a.replaced}).temp}const o=`__TSR_SSR__.initMatch(${S({id:t.id,__beforeLoadContext:r.ssr.serializer.stringify(t.__beforeLoadContext),loaderData:r.ssr.serializer.stringify(n),error:r.ssr.serializer.stringify(t.error),extracted:s?.map(a=>K(a,["type","path"])),updatedAt:t.updatedAt,status:t.status},{isScriptContext:!0,wrap:!0,json:!0})})`;r.serverSsr.injectScript(()=>o),s&&s.forEach(a=>a.type==="promise"?i(a):d(a));function i(a){r.serverSsr.injectScript(async()=>(await a.promise,`__TSR_SSR__.resolvePromise(${S({matchId:t.id,id:a.id,promiseState:a.promise[G]},{isScriptContext:!0,wrap:!0,json:!0})})`))}function d(a){r.serverSsr.injectHtml(async()=>{try{const p=a.stream.getReader();let f=null;for(;!(f=await p.read()).done;)if(f.value){const C=`__TSR_SSR__.injectChunk(${S({matchId:t.id,id:a.id,chunk:f.value},{isScriptContext:!0,wrap:!0,json:!0})})`;r.serverSsr.injectScript(()=>C)}r.serverSsr.injectScript(()=>`__TSR_SSR__.closeStream(${S({matchId:t.id,id:a.id},{isScriptContext:!0,wrap:!0,json:!0})})`)}catch(p){console.error("stream read error",p)}return""})}}function P(e,r,t){if(r.length===0)return t;const[s,...n]=r;return Array.isArray(e)?e.map((o,i)=>i===Number(s)?P(o,n,t):o):h(e)?{...e,[s]:P(e[s],n,t)}:e}function A(e,r,t=[]){if(J(e))return e.map((n,o)=>A(n,r,[...t,`${o}`]));if(h(e)){const n={};for(const o in e)n[o]=A(e[o],r,[...t,o]);return n}const s=r(e,t);return s!==e?s:e}function Re({createRouter:e,getRouterManifest:r}){return t=>ce(async s=>{const n=de(s),o=new URL(n.url),i=o.href.replace(o.origin,""),d=Z({initialEntries:[i]}),a=e();he(a,r?.()),a.update({history:d}),await a.load(),Se(a);const p=ge({event:s,router:a});return await t({request:n,router:a,responseHeaders:p})})}function ge(e){let r=k(le(e.event),e.event.___ssrRpcResponseHeaders,{"Content-Type":"text/html; charset=UTF-8"},...e.router.state.matches.map(s=>s.headers));const{redirect:t}=e.router.state;return t&&(r=k(r,t.headers,{Location:t.href})),r}function we(e,r){return W(e,r)}function xe(e,r){return M.fromWeb(W(e,M.toWeb(r)))}const ve=/(<body)/,be=/(<\/body>)/,Ce=/(<\/html>)/,Te=/(<head.*?>)/,Ee=/(<\/[a-zA-Z][\w:.-]*?>)/g,je=new TextDecoder;function He(){let e;const r=new TextEncoder,s={stream:new fe({start(n){e=n}}),write:n=>{e.enqueue(r.encode(n))},end:n=>{n&&e.enqueue(r.encode(n)),e.close(),s.destroyed=!0},destroy:n=>{e.error(n)},destroyed:!1};return s}async function Pe(e,r){var t,s,n;try{const o=e.getReader();let i;for(;!(i=await o.read()).done;)(t=r.onData)==null||t.call(r,i);(s=r.onEnd)==null||s.call(r)}catch(o){(n=r.onError)==null||n.call(r,o)}}function W(e,r){const t=He();let s=!0,n="",o="",i=!1,d=!1,a="",p="";function f(){const c=n;return n="",c}function C(c){return c instanceof Uint8Array?je.decode(c):String(c)}const R=Q();let g=0;e.serverSsr.injectedHtml.forEach(c=>{D(c)});const L=e.subscribe("onInjectedHtml",c=>{D(c.promise)});function D(c){g++,c.then(w=>{i?t.write(w):n+=w}).catch(R.reject).finally(()=>{g--,!s&&g===0&&(L(),R.resolve())})}return R.then(()=>{const c=p+f()+o;t.end(c)}).catch(c=>{console.error("Error reading routerStream:",c),t.destroy(c)}),Pe(r,{onData:c=>{const w=C(c.value);let l=a+w;const T=l.match(be),I=l.match(Ce);if(i||l.match(ve)&&(i=!0),!d){const m=l.match(Te);if(m){d=!0;const $=m.index,O=m[0],q=l.slice($+O.length);t.write(l.slice(0,$)+O+f()),l=q}}if(!i){t.write(l),a="";return}if(T&&I&&T.index<I.index){const m=T.index;o=l.slice(m),t.write(l.slice(0,m)+f()),a="";return}let E,x=0;for(;(E=Ee.exec(l))!==null;)x=E.index+E[0].length;if(x>0){const m=l.slice(0,x)+f()+p;t.write(m),a=l.slice(x)}else a=l,p+=f()},onEnd:()=>{s=!1,g===0&&R.resolve()},onError:c=>{console.error("Error reading appStream:",c),t.destroy(c)}}),t.stream}const Ae=async({request:e,router:r,responseHeaders:t})=>{if(typeof v.renderToReadableStream=="function"){const s=await v.renderToReadableStream(u(N,{router:r}),{signal:e.signal});z(e.headers.get("User-Agent"))&&await s.allReady;const n=we(r,s);return new Response(n,{status:r.state.statusCode,headers:t})}if(typeof v.renderToPipeableStream=="function"){const s=new ue;try{const o=v.renderToPipeableStream(u(N,{router:r}),{...z(e.headers.get("User-Agent"))?{onAllReady(){o.pipe(s)}}:{onShellReady(){o.pipe(s)}},onError:(i,d)=>{console.error("Error in renderToPipeableStream:",i,d)}})}catch(o){console.error("Error in renderToPipeableStream:",o)}const n=xe(r,s);return new Response(n,{status:r.state.statusCode,headers:t})}throw new Error("No renderToReadableStream or renderToPipeableStream found in react-dom/server. Ensure you are using a version of react-dom that supports streaming.")},De=()=>({routes:{__root__:{filePath:"__root.tsx",children:["/"],preloads:["/_build/assets/client-Bpvzk9ya.js","/_build/assets/client-D-2rl7ld.js"]},"/":{filePath:"index.tsx"}}});function Ie(e){return globalThis.MANIFEST[e]}function $e(){const e=De(),r=e.routes.__root__=e.routes.__root__||{};r.assets=r.assets||[];let t="";const s=Ie("client"),n=s.inputs[s.handler]?.output.path;return n||X(n,"Could not find client entry in vinxi manifest"),r.assets.push({tag:"script",attrs:{type:"module",suppressHydrationWarning:!0,async:!0},children:`${t}import("${n}")`}),e}function Oe(){const e=$e();return{...e,routes:Object.fromEntries(Object.entries(e.routes).map(([r,t])=>{const{preloads:s,assets:n}=t;return[r,{preloads:s,assets:n}]}))}}const Me="/_build/assets/app-CY7WGVNl.css",j={suppressHydrationWarning:!0},B=ee({head:()=>({meta:[{charSet:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{title:"EcoPay - Secure Crypto Exchange"}],links:[{rel:"stylesheet",href:Me}]}),component:ze,errorComponent:({error:e})=>u("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:H("div",{className:"text-center space-y-4",children:[u("h1",{className:"text-2xl font-bold text-destructive",children:"Something went wrong!"}),u("p",{className:"text-muted-foreground",children:e?.message||"An unexpected error occurred"}),u("a",{href:"/",className:"text-primary hover:underline",children:"Return to home"})]})})});function ze(){return u(Ne,{children:u(te,{})})}function Ne({children:e}){return H("html",{...j,children:[u("head",{...j,children:u(re,{})}),H("body",{...j,children:[u("div",{id:"app",children:e}),u(ne,{})]})]})}const ke=()=>import("./assets/index-CsObXEje.js"),F=se("/")({component:oe(ke,"component",()=>F.ssr)}),We=F.update({id:"/",path:"/",getParentRoute:()=>B}),Be={IndexRoute:We},Fe=B._addFileChildren(Be)._addFileTypes();function Le(){return ae({routeTree:Fe,scrollRestoration:!0})}const et=Re({createRouter:Le,getRouterManifest:Oe})(Ae);export{et as default};
