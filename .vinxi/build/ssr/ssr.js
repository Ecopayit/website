import{RouterProvider as q,isPlainObject as h,warning as U,pick as V,TSR_DEFERRED_PROMISE as K,isPlainArray as J,defer as G,createMemoryHistory as Z,createControlledPromise as Q,invariant as X,createRootRoute as Y,Outlet as ee,HeadContent as te,Scripts as re,createFileRoute as ne,lazyRouteComponent as se,createRouter as oe}from"@tanstack/react-router";import{jsx as u,jsxs as j}from"react/jsx-runtime";import{splitSetCookieString as ae}from"cookie-es";import{eventHandler as ie,toWebRequest as ce,getResponseHeaders as de}from"h3";import S from"jsesc";import"node:async_hooks";import{Readable as O,PassThrough as le}from"node:stream";import{isbot as M}from"isbot";import v from"react-dom/server";import{ReadableStream as ue}from"node:stream/web";function z(e){return u(q,{router:e.router})}function fe(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function N(...e){return e.reduce((r,t)=>{const s=fe(t);for(const[n,o]of s.entries())n==="set-cookie"?ae(o).forEach(d=>r.append("set-cookie",d)):r.set(n,o);return r},new Headers)}const y={stringify:e=>JSON.stringify(e,function(t,s){const n=this[t],o=b.find(i=>i.stringifyCondition(n));return o?o.stringify(n):s}),parse:e=>JSON.parse(e,function(t,s){const n=this[t];if(h(n)){const o=b.find(i=>i.parseCondition(n));if(o)return o.parse(n)}return s}),encode:e=>{if(Array.isArray(e))return e.map(t=>y.encode(t));if(h(e))return Object.fromEntries(Object.entries(e).map(([t,s])=>[t,y.encode(s)]));const r=b.find(t=>t.stringifyCondition(e));return r?r.stringify(e):e},decode:e=>{if(h(e)){const r=b.find(t=>t.parseCondition(e));if(r)return r.parse(e)}return Array.isArray(e)?e.map(r=>y.decode(r)):h(e)?Object.fromEntries(Object.entries(e).map(([r,t])=>[r,y.decode(t)])):e}},_=(e,r,t,s)=>({key:e,stringifyCondition:r,stringify:n=>({[`$${e}`]:t(n)}),parseCondition:n=>Object.hasOwn(n,`$${e}`),parse:n=>s(n[`$${e}`])}),b=[_("undefined",e=>e===void 0,()=>0,()=>{}),_("date",e=>e instanceof Date,e=>e.toISOString(),e=>new Date(e)),_("error",e=>e instanceof Error,e=>({...e,message:e.message,stack:void 0,cause:e.cause}),e=>Object.assign(new Error(e.message),e)),_("formData",e=>e instanceof FormData,e=>{const r={};return e.forEach((t,s)=>{const n=r[s];n!==void 0?Array.isArray(n)?n.push(t):r[s]=[n,t]:r[s]=t}),r},e=>{const r=new FormData;return Object.entries(e).forEach(([t,s])=>{Array.isArray(s)?s.forEach(n=>r.append(t,n)):r.append(t,s)}),r}),_("bigint",e=>typeof e=="bigint",e=>e.toString(),e=>BigInt(e))],me=`const __TSR_SSR__={matches:[],streamedValues:{},initMatch:o=>(__TSR_SSR__.matches.push(o),o.extracted?.forEach(l=>{if(l.type==="stream"){let r;l.value=new ReadableStream({start(e){r={enqueue:t=>{try{e.enqueue(t)}catch{}},close:()=>{try{e.close()}catch{}}}}}),l.value.controller=r}else{let r,e;l.value=new Promise((t,a)=>{e=a,r=t}),l.value.reject=e,l.value.resolve=r}}),!0),resolvePromise:({matchId:o,id:l,promiseState:r})=>{const e=__TSR_SSR__.matches.find(t=>t.id===o);if(e){const t=e.extracted?.[l];if(t&&t.type==="promise"&&t.value&&r.status==="success")return t.value.resolve(r.data),!0}return!1},injectChunk:({matchId:o,id:l,chunk:r})=>{const e=__TSR_SSR__.matches.find(t=>t.id===o);if(e){const t=e.extracted?.[l];if(t&&t.type==="stream"&&t.value?.controller)return t.value.controller.enqueue(new TextEncoder().encode(r.toString())),!0}return!1},closeStream:({matchId:o,id:l})=>{const r=__TSR_SSR__.matches.find(e=>e.id===o);if(r){const e=r.extracted?.[l];if(e&&e.type==="stream"&&e.value?.controller)return e.value.controller.close(),!0}return!1},cleanScripts:()=>{document.querySelectorAll(".tsr-once").forEach(o=>{o.remove()})}};window.__TSR_SSR__=__TSR_SSR__;
`;function pe(e,r){e.ssr={manifest:r,serializer:y},e.serverSsr={injectedHtml:[],streamedKeys:new Set,injectHtml:t=>{const s=Promise.resolve().then(t);return e.serverSsr.injectedHtml.push(s),e.emit({type:"onInjectedHtml",promise:s}),s.then(()=>{})},injectScript:(t,s)=>e.serverSsr.injectHtml(async()=>`<script class='tsr-once'>${await t()}; if (typeof __TSR_SSR__ !== 'undefined') __TSR_SSR__.cleanScripts()<\/script>`),streamValue:(t,s)=>{U(!e.serverSsr.streamedKeys.has(t),"Key has already been streamed: "+t),e.serverSsr.streamedKeys.add(t),e.serverSsr.injectScript(()=>`__TSR_SSR__.streamedValues['${t}'] = { value: ${S(e.ssr.serializer.stringify(s),{isScriptContext:!0,wrap:!0,json:!0})}}`)},onMatchSettled:_e},e.serverSsr.injectScript(()=>me,{logScript:!1})}function he(e){var r,t;const s={manifest:e.ssr.manifest,dehydratedData:(t=(r=e.options).dehydrate)==null?void 0:t.call(r)};e.serverSsr.injectScript(()=>`__TSR_SSR__.dehydrated = ${S(e.ssr.serializer.stringify(s),{isScriptContext:!0,wrap:!0,json:!0})}`)}function Se(e,r){const t=[];return{replaced:P(e,(n,o)=>{if(n instanceof ReadableStream){const[i,d]=n.tee(),a={type:"stream",path:o,id:t.length,matchIndex:r.match.index,stream:d};return t.push(a),i}else if(n instanceof Promise){const i=G(n),d={type:"promise",path:o,id:t.length,matchIndex:r.match.index,promise:i};t.push(d)}return n}),extracted:t}}function _e(e){const{router:r,match:t}=e;let s,n;if(t.loaderData!==void 0){const a=Se(t.loaderData,{match:t});t.loaderData=a.replaced,s=a.extracted,n=s.reduce((m,f)=>H(m,["temp",...f.path],void 0),{temp:a.replaced}).temp}const o=`__TSR_SSR__.initMatch(${S({id:t.id,__beforeLoadContext:r.ssr.serializer.stringify(t.__beforeLoadContext),loaderData:r.ssr.serializer.stringify(n),error:r.ssr.serializer.stringify(t.error),extracted:s?.map(a=>V(a,["type","path"])),updatedAt:t.updatedAt,status:t.status},{isScriptContext:!0,wrap:!0,json:!0})})`;r.serverSsr.injectScript(()=>o),s&&s.forEach(a=>a.type==="promise"?i(a):d(a));function i(a){r.serverSsr.injectScript(async()=>(await a.promise,`__TSR_SSR__.resolvePromise(${S({matchId:t.id,id:a.id,promiseState:a.promise[K]},{isScriptContext:!0,wrap:!0,json:!0})})`))}function d(a){r.serverSsr.injectHtml(async()=>{try{const m=a.stream.getReader();let f=null;for(;!(f=await m.read()).done;)if(f.value){const C=`__TSR_SSR__.injectChunk(${S({matchId:t.id,id:a.id,chunk:f.value},{isScriptContext:!0,wrap:!0,json:!0})})`;r.serverSsr.injectScript(()=>C)}r.serverSsr.injectScript(()=>`__TSR_SSR__.closeStream(${S({matchId:t.id,id:a.id},{isScriptContext:!0,wrap:!0,json:!0})})`)}catch(m){console.error("stream read error",m)}return""})}}function H(e,r,t){if(r.length===0)return t;const[s,...n]=r;return Array.isArray(e)?e.map((o,i)=>i===Number(s)?H(o,n,t):o):h(e)?{...e,[s]:H(e[s],n,t)}:e}function P(e,r,t=[]){if(J(e))return e.map((n,o)=>P(n,r,[...t,`${o}`]));if(h(e)){const n={};for(const o in e)n[o]=P(e[o],r,[...t,o]);return n}const s=r(e,t);return s!==e?s:e}function ye({createRouter:e,getRouterManifest:r}){return t=>ie(async s=>{const n=ce(s),o=new URL(n.url),i=o.href.replace(o.origin,""),d=Z({initialEntries:[i]}),a=e();pe(a,r?.()),a.update({history:d}),await a.load(),he(a);const m=Re({event:s,router:a});return await t({request:n,router:a,responseHeaders:m})})}function Re(e){let r=N(de(e.event),e.event.___ssrRpcResponseHeaders,{"Content-Type":"text/html; charset=UTF-8"},...e.router.state.matches.map(s=>s.headers));const{redirect:t}=e.router.state;return t&&(r=N(r,t.headers,{Location:t.href})),r}function ge(e,r){return B(e,r)}function we(e,r){return O.fromWeb(B(e,O.toWeb(r)))}const xe=/(<body)/,ve=/(<\/body>)/,be=/(<\/html>)/,Ce=/(<head.*?>)/,Te=/(<\/[a-zA-Z][\w:.-]*?>)/g,Ee=new TextDecoder;function je(){let e;const r=new TextEncoder,s={stream:new ue({start(n){e=n}}),write:n=>{e.enqueue(r.encode(n))},end:n=>{n&&e.enqueue(r.encode(n)),e.close(),s.destroyed=!0},destroy:n=>{e.error(n)},destroyed:!1};return s}async function He(e,r){var t,s,n;try{const o=e.getReader();let i;for(;!(i=await o.read()).done;)(t=r.onData)==null||t.call(r,i);(s=r.onEnd)==null||s.call(r)}catch(o){(n=r.onError)==null||n.call(r,o)}}function B(e,r){const t=je();let s=!0,n="",o="",i=!1,d=!1,a="",m="";function f(){const c=n;return n="",c}function C(c){return c instanceof Uint8Array?Ee.decode(c):String(c)}const R=Q();let g=0;e.serverSsr.injectedHtml.forEach(c=>{A(c)});const L=e.subscribe("onInjectedHtml",c=>{A(c.promise)});function A(c){g++,c.then(w=>{i?t.write(w):n+=w}).catch(R.reject).finally(()=>{g--,!s&&g===0&&(L(),R.resolve())})}return R.then(()=>{const c=m+f()+o;t.end(c)}).catch(c=>{console.error("Error reading routerStream:",c),t.destroy(c)}),He(r,{onData:c=>{const w=C(c.value);let l=a+w;const T=l.match(ve),D=l.match(be);if(i||l.match(xe)&&(i=!0),!d){const p=l.match(Ce);if(p){d=!0;const I=p.index,$=p[0],W=l.slice(I+$.length);t.write(l.slice(0,I)+$+f()),l=W}}if(!i){t.write(l),a="";return}if(T&&D&&T.index<D.index){const p=T.index;o=l.slice(p),t.write(l.slice(0,p)+f()),a="";return}let E,x=0;for(;(E=Te.exec(l))!==null;)x=E.index+E[0].length;if(x>0){const p=l.slice(0,x)+f()+m;t.write(p),a=l.slice(x)}else a=l,m+=f()},onEnd:()=>{s=!1,g===0&&R.resolve()},onError:c=>{console.error("Error reading appStream:",c),t.destroy(c)}}),t.stream}const Pe=async({request:e,router:r,responseHeaders:t})=>{if(typeof v.renderToReadableStream=="function"){const s=await v.renderToReadableStream(u(z,{router:r}),{signal:e.signal});M(e.headers.get("User-Agent"))&&await s.allReady;const n=ge(r,s);return new Response(n,{status:r.state.statusCode,headers:t})}if(typeof v.renderToPipeableStream=="function"){const s=new le;try{const o=v.renderToPipeableStream(u(z,{router:r}),{...M(e.headers.get("User-Agent"))?{onAllReady(){o.pipe(s)}}:{onShellReady(){o.pipe(s)}},onError:(i,d)=>{console.error("Error in renderToPipeableStream:",i,d)}})}catch(o){console.error("Error in renderToPipeableStream:",o)}const n=we(r,s);return new Response(n,{status:r.state.statusCode,headers:t})}throw new Error("No renderToReadableStream or renderToPipeableStream found in react-dom/server. Ensure you are using a version of react-dom that supports streaming.")},Ae=()=>({routes:{__root__:{filePath:"__root.tsx",children:["/"],preloads:["/_build/assets/client-CLP_h_y_.js","/_build/assets/client-BD0x6cCO.js"]},"/":{filePath:"index.tsx"}}});function De(e){return globalThis.MANIFEST[e]}function Ie(){const e=Ae(),r=e.routes.__root__=e.routes.__root__||{};r.assets=r.assets||[];let t="";const s=De("client"),n=s.inputs[s.handler]?.output.path;return n||X(n,"Could not find client entry in vinxi manifest"),r.assets.push({tag:"script",attrs:{type:"module",suppressHydrationWarning:!0,async:!0},children:`${t}import("${n}")`}),e}function $e(){const e=Ie();return{...e,routes:Object.fromEntries(Object.entries(e.routes).map(([r,t])=>{const{preloads:s,assets:n}=t;return[r,{preloads:s,assets:n}]}))}}const Oe=[{charSet:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{title:"EcoPay - Secure Crypto Exchange"}],F=Y({head:()=>({meta:Oe}),component:Me,errorComponent:({error:e})=>u("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:j("div",{className:"text-center space-y-4",children:[u("h1",{className:"text-2xl font-bold text-destructive",children:"Something went wrong!"}),u("p",{className:"text-muted-foreground",children:e?.message||"An unexpected error occurred"}),u("a",{href:"/",className:"text-primary hover:underline",children:"Return to home"})]})})});function Me(){return u(ze,{children:u(ee,{})})}function ze({children:e}){return j("html",{lang:"en",children:[u("head",{children:u(te,{})}),j("body",{children:[u("div",{id:"app",children:e}),u(re,{})]})]})}const Ne=()=>import("./assets/index-CsObXEje.js"),k=ne("/")({component:se(Ne,"component",()=>k.ssr)}),Be=k.update({id:"/",path:"/",getParentRoute:()=>F}),Fe={IndexRoute:Be},ke=F._addFileChildren(Fe)._addFileTypes();function Le(){return oe({routeTree:ke,scrollRestoration:!0})}const Ye=ye({createRouter:Le,getRouterManifest:$e})(Pe);export{Ye as default};
